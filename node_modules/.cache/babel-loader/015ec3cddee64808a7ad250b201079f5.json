{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nimport * as L from \"leaflet\";\nimport \"src/decidim/map/icon.js\"; // comes with Decidim\n\nimport \"src/decidim/vendor/leaflet-tilelayer-here\";\nimport \"leaflet.markercluster\"; // Comes with Decidim\n\nimport \"leaflet.featuregroup.subgroup\"; // included in this package.json\n\nimport \"src/vendor/jquery.truncate\";\nimport \"jsrender\";\nimport ControlsUI from \"src/decidim/decidim_awesome/awesome_map/controls_ui\";\nimport ProposalsController from \"src/decidim/decidim_awesome/awesome_map/controllers/proposals_controller\";\nimport MeetingsController from \"src/decidim/decidim_awesome/awesome_map/controllers/meetings_controller\";\n\nvar AwesomeMap = /*#__PURE__*/function () {\n  function AwesomeMap(map, config) {\n    _classCallCheck(this, AwesomeMap);\n\n    this.map = map;\n    this.categories = window.AwesomeMap && window.AwesomeMap.categories || [];\n    this.config = $.extend({\n      length: 255,\n      center: null,\n      zoom: 8,\n      menu: {\n        amendments: false,\n        meetings: false,\n        categories: true,\n        hashtags: false,\n        mergeComponents: false\n      },\n      show: {\n        withdrawn: false,\n        accepted: false,\n        evaluating: false,\n        notAnswered: false,\n        rejected: false\n      },\n      hideControls: false,\n      collapsedMenu: false,\n      components: []\n    }, config);\n    this.layers = {};\n    this.cluster = new L.MarkerClusterGroup();\n    this.map.addLayer(this.cluster);\n    this.controls = new ControlsUI(this);\n\n    this.onFinished = function () {};\n\n    this.controllers = {};\n    this.loading = [];\n    this._firstController = {};\n  } // Queries the API and load all the markers\n\n\n  _createClass(AwesomeMap, [{\n    key: \"loadControllers\",\n    value: function loadControllers() {\n      var _this = this;\n\n      this.autoResize();\n      this.controls.attach();\n      this.config.components.forEach(function (component) {\n        var controller = _this._getController(component);\n\n        if (controller) {\n          controller.loadNodes();\n\n          _this.loading.push(component.type);\n\n          controller.onFinished = function () {\n            _this.loading.pop();\n\n            _this.autoResize();\n\n            if (_this.loading.length == 0) {\n              _this.controls.$loading.hide(); // call trigger as all loads are finished\n\n\n              _this.onFinished();\n            }\n          };\n        }\n      });\n    }\n  }, {\n    key: \"autoResize\",\n    value: function autoResize() {\n      // Setup center/zoom options if specified, otherwise fitbounds\n      var bounds = this.cluster.getBounds();\n\n      if (this.config.center && this.config.zoom) {\n        this.map.setView(this.config.center, this.config.zoom);\n      } else if (bounds.isValid()) {\n        // this.map.fitBounds(bounds, { padding: [50, 50] }); // this doesn't work much of the time, probably some race condition\n        this.map.fitBounds([[bounds.getNorth(), bounds.getEast()], [bounds.getSouth(), bounds.getWest()]], {\n          padding: [50, 50]\n        });\n      }\n    }\n  }, {\n    key: \"getCategory\",\n    value: function getCategory(category) {\n      var _this2 = this;\n\n      var defaultCat = {\n        color: getComputedStyle(document.documentElement).getPropertyValue(\"--primary\"),\n        children: function children() {},\n        parent: null,\n        name: null\n      };\n\n      if (category) {\n        var id = category.id ? parseInt(category.id, 10) : parseInt(category, 10);\n        var cat = this.categories.find(function (c) {\n          return c.id == id;\n        });\n\n        if (cat) {\n          cat.children = function () {\n            return _this2.categories.filter(function (c) {\n              return c.parent === cat.id;\n            });\n          };\n\n          return cat;\n        }\n      }\n\n      return defaultCat;\n    }\n  }, {\n    key: \"_getController\",\n    value: function _getController(component) {\n      var controller;\n\n      if (component.type == \"proposals\") {\n        controller = new ProposalsController(this, component);\n      }\n\n      if (component.type == \"meetings\" && this.config.menu.meetings) {\n        controller = new MeetingsController(this, component);\n      }\n\n      if (controller) {\n        // Agrupate layers for controlling components\n        if (this._firstController[component.type] && this.config.menu.mergeComponents) {\n          controller.controls = this._firstController[component.type].controls;\n        } else {\n          controller.addControls();\n        }\n\n        this._firstController[component.type] = this._firstController[component.type] || controller;\n        this.controllers[component.type] = controller;\n        return this.controllers[component.type];\n      }\n    }\n  }]);\n\n  return AwesomeMap;\n}();\n\nexport { AwesomeMap as default };","map":{"version":3,"mappings":"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","names":["L","ControlsUI","ProposalsController","MeetingsController","AwesomeMap","map","config","_classCallCheck","categories","window","$","extend","length","center","zoom","menu","amendments","meetings","hashtags","mergeComponents","show","withdrawn","accepted","evaluating","notAnswered","rejected","hideControls","collapsedMenu","components","layers","cluster","MarkerClusterGroup","addLayer","controls","onFinished","controllers","loading","_firstController","autoResize","attach","forEach","component","controller","_this","_getController","loadNodes","push","type","pop","$loading","hide","bounds","getBounds","setView","isValid","fitBounds","getNorth","getEast","getSouth","getWest","padding","category","defaultCat","color","getComputedStyle","document","documentElement","getPropertyValue","children","parent","name","id","parseInt","cat","find","c","_this2","filter","addControls"],"sources":["/home/injam/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/decidim-decidim_awesome-0.8.3/app/packs/src/decidim/decidim_awesome/awesome_map/awesome_map.js"],"sourcesContent":["import * as L from \"leaflet\";\nimport \"src/decidim/map/icon.js\" // comes with Decidim\nimport \"src/decidim/vendor/leaflet-tilelayer-here\"\nimport \"leaflet.markercluster\"; // Comes with Decidim\nimport \"leaflet.featuregroup.subgroup\" // included in this package.json\nimport \"src/vendor/jquery.truncate\"\nimport \"jsrender\"\n\nimport ControlsUI from \"src/decidim/decidim_awesome/awesome_map/controls_ui\";\nimport ProposalsController from \"src/decidim/decidim_awesome/awesome_map/controllers/proposals_controller\";\nimport MeetingsController from \"src/decidim/decidim_awesome/awesome_map/controllers/meetings_controller\";\n\nexport default class AwesomeMap {\n  constructor(map, config) {\n    this.map = map;\n    this.categories = window.AwesomeMap && window.AwesomeMap.categories || []\n    this.config = $.extend({\n      length: 255,\n      center: null,\n      zoom: 8,\n      menu: {\n        amendments: false,\n        meetings: false,\n        categories: true,\n        hashtags: false,\n        mergeComponents: false\n      },\n      show: {\n        withdrawn: false,\n        accepted: false,\n        evaluating: false,\n        notAnswered: false,\n        rejected: false\n      },\n      hideControls: false,\n      collapsedMenu: false,\n      components: []\n    }, config);\n    this.layers = {};\n    this.cluster = new L.MarkerClusterGroup();\n    this.map.addLayer(this.cluster);\n    this.controls = new ControlsUI(this);\n    this.onFinished = () => {};\n    this.controllers = {};\n    this.loading = [];\n    this._firstController = {};\n  }\n\n  // Queries the API and load all the markers\n  loadControllers() {\n    this.autoResize();\n    this.controls.attach();\n\n    this.config.components.forEach((component) => {\n      const controller = this._getController(component);\n      if (controller) {\n        controller.loadNodes();\n        this.loading.push(component.type);\n        controller.onFinished = () => {\n          this.loading.pop();\n          this.autoResize();\n\n          if (this.loading.length == 0) {\n            this.controls.$loading.hide();\n            // call trigger as all loads are finished\n            this.onFinished();\n          }\n        };\n      }\n    });\n  }\n\n  autoResize() {\n    // Setup center/zoom options if specified, otherwise fitbounds\n    const bounds = this.cluster.getBounds()\n    if (this.config.center && this.config.zoom) {\n      this.map.setView(this.config.center, this.config.zoom);\n    } else if (bounds.isValid()) {\n      // this.map.fitBounds(bounds, { padding: [50, 50] }); // this doesn't work much of the time, probably some race condition\n      this.map.fitBounds([[bounds.getNorth(), bounds.getEast()], [bounds.getSouth(), bounds.getWest()]], { padding: [50, 50] });\n    }\n  }\n\n  getCategory(category) {\n    let defaultCat = {\n      color: getComputedStyle(document.documentElement).getPropertyValue(\"--primary\"),\n      children: () => {},\n      parent: null,\n      name: null\n    };\n\n    if (category) {\n      let id = category.id\n        ? parseInt(category.id, 10)\n        : parseInt(category, 10);\n      let cat = this.categories.find((c) => c.id == id);\n      if (cat) {\n        cat.children = () => {\n          return this.categories.filter((c) => c.parent === cat.id);\n        }\n        return cat;\n      }\n    }\n    return defaultCat;\n  }\n\n  _getController(component) {\n    let controller;\n\n    if (component.type == \"proposals\") {\n      controller = new ProposalsController(this, component);\n    }\n    if (component.type == \"meetings\" && this.config.menu.meetings) {\n      controller = new MeetingsController(this, component);\n    }\n\n    if (controller) {\n      // Agrupate layers for controlling components\n      if (this._firstController[component.type] && this.config.menu.mergeComponents) {\n        controller.controls = this._firstController[component.type].controls;\n      } else  {\n        controller.addControls();\n      }\n      this._firstController[component.type] = this._firstController[component.type] || controller;\n      this.controllers[component.type] = controller;\n      return this.controllers[component.type]\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}