{"ast":null,"code":"/* global d3 */\n\n/* eslint-disable require-jsdoc, id-length, no-undefined, no-unused-vars, multiline-ternary, no-ternary, no-nested-ternary, no-invalid-this */\n\n/* eslint prefer-reflect: [\"error\", { \"exceptions\": [\"call\"] }] */\n\n/* eslint dot-location: [\"error\", \"property\"] */\n\n/* eslint no-unused-vars: 0 */\nimport * as d3 from \"d3\"; // lib\n\nexport default function areachart() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  var parseData = function parseData(data) {\n    // format the data\n    data.forEach(function (d) {\n      d.key = d3.isoParse(d.key);\n      d.value = Number(d.value);\n    }); // order by date\n\n    return data.sort(function (x, y) {\n      return d3.ascending(x.key, y.key);\n    });\n  }; // OPTIONAL: Helper function to accumulates all data values\n\n\n  var aggregate = function aggregate(agg) {\n    return agg.map(function (item, index, array) {\n      if (index > 0) {\n        item.value += array[index - 1].value;\n      }\n\n      return item;\n    });\n  }; // parse opts\n\n\n  var data = parseData(opts.data);\n  var title = opts.title;\n  var objectName = opts.objectName || \"\";\n  var container = d3.select(opts.container);\n  var showAxis = opts.axis || false;\n  var ratio = (opts.ratio || \"\").split(\":\").reduce(function (a, b) {\n    return a / b;\n  }) || 4 / 3;\n  var showTooltip = Object.is(opts.tip, undefined) ? true : opts.tip;\n  var cumulative = opts.agg || false;\n\n  if (cumulative) {\n    data = aggregate(data);\n  } // set the dimensions and margins of the graph\n\n\n  var margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  };\n  var width = Number(container.node().getBoundingClientRect().width) - margin.left - margin.right;\n  var height = width / ratio - margin.top - margin.bottom;\n  var titlePadding = d3.min([width / 10, 32]); // set the ranges\n\n  var x = d3.scaleTime().range([0, width]);\n  var y = d3.scaleLinear().range([height, 0]); // define the area\n\n  var area = d3.area().x(function (d) {\n    return x(d.key);\n  }).y0(height).y1(function (d) {\n    return y(d.value);\n  }); // define the line\n\n  var valueline = d3.line().x(function (d) {\n    return x(d.key);\n  }).y(function (d) {\n    return y(d.value);\n  });\n  var svg = container.append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\".concat(margin.left, \",\").concat(margin.top, \")\")); // scale the range of the data\n\n  x.domain(d3.extent(data, function (d) {\n    return d.key;\n  }));\n  y.domain([0, d3.max(data, function (d) {\n    return d.value;\n  })]).nice(); // add the valueline path.\n\n  var topLine = svg.append(\"path\").data([data]).attr(\"class\", \"line\").attr(\"d\", valueline); // add the area\n\n  svg.append(\"path\").data([data]).attr(\"class\", \"area\").attr(\"d\", area);\n\n  if (showTooltip) {\n    // tooltip\n    var circle = svg.append(\"circle\").attr(\"class\", \"circle\").attr(\"r\", 6).style(\"display\", \"none\");\n    var tooltip = d3.select(\"body\").append(\"div\").attr(\"id\", \"\".concat(container.node().id, \"-tooltip\")).attr(\"class\", \"chart-tooltip\").style(\"opacity\", 0);\n    svg.on(\"mouseover\", function () {\n      circle.style(\"display\", null);\n      tooltip.style(\"opacity\", 1);\n    }).on(\"mouseout\", function () {\n      circle.style(\"display\", \"none\");\n      tooltip.style(\"opacity\", 0);\n    }).on(\"mousemove\", function () {\n      var x0 = x.invert(d3.mouse(this)[0]);\n      var i = d3.bisector(function (d) {\n        return d.key;\n      }).left(data, x0, 1);\n      var d0 = data[i - 1];\n      var d1 = data[i];\n      var d = x0 - d0.key > d1.key - x0 ? d1 : d0; // svg position relative to document\n\n      var coords = {\n        x: window.pageXOffset + container.node().getBoundingClientRect().left,\n        y: window.pageYOffset + container.node().getBoundingClientRect().top\n      };\n      var tooltipContent = \"\\n          <div class=\\\"tooltip-content\\\">\\n            \".concat(d3.timeFormat(\"%e %B %Y\")(d.key), \"<br />\\n            \").concat(d.value.toLocaleString(), \" \").concat(objectName, \"\\n          </div>\");\n      circle.attr(\"transform\", \"translate(\".concat(x(d.key), \",\").concat(y(d.value), \")\"));\n      tooltip.html(tooltipContent).style(\"left\", \"\".concat(coords.x + x(d.key), \"px\")).style(\"top\", \"\".concat(coords.y + y(d.value), \"px\"));\n    });\n  }\n\n  if (showAxis) {\n    var xAxis = d3.axisBottom(x).ticks(d3.timeMonth).tickFormat(d3.timeFormat(\"%b %y\")).tickSize(-height);\n    var yAxis = d3.axisLeft(y).ticks(5).tickSize(8);\n\n    var _xAxis = function _xAxis(g) {\n      g.call(xAxis);\n      g.select(\".domain\").remove();\n      g.selectAll(\".tick line\").attr(\"class\", \"dashed\");\n      g.selectAll(\".tick text\").attr(\"y\", 6);\n    };\n\n    var _yAxis = function _yAxis(g) {\n      g.call(yAxis);\n      g.select(\".domain\").remove();\n      g.select(\".tick:first-of-type\").remove();\n      g.selectAll(\".tick text\").attr(\"text-anchor\", \"start\").attr(\"x\", 6);\n    }; // custom X-Axis\n\n\n    svg.append(\"g\").attr(\"transform\", \"translate(0,\".concat(height, \")\")).call(_xAxis); // custom Y-Axis\n\n    svg.append(\"g\").call(_yAxis); // last circle (current value)\n\n    var g = svg.append(\"g\").data([data]).attr(\"transform\", function (d) {\n      return \"translate(\".concat(x(d[d.length - 1].key), \",\").concat(y(d[d.length - 1].value), \")\");\n    });\n    g.append(\"circle\").attr(\"class\", \"circle\").attr(\"r\", 8);\n    g.append(\"text\").attr(\"class\", \"sum\").attr(\"text-anchor\", \"end\").attr(\"dx\", -8 * 2).text(function (d) {\n      return d[d.length - 1].value.toLocaleString();\n    });\n  } else {\n    // add the title group\n    var _g = svg.append(\"g\").attr(\"text-anchor\", \"start\").attr(\"transform\", \"translate(\".concat(titlePadding, \",\").concat(titlePadding, \")\"));\n\n    var titleLines = 0;\n\n    if (title.length) {\n      _g.append(\"text\").attr(\"x\", 0).attr(\"y\", 0).attr(\"class\", \"title\").text(title).call(function (fulltext, wrapwidth) {\n        var start = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n        fulltext.each(function () {\n          var text = d3.select(this);\n          var word = \"\";\n          var words = text.text().split(/\\s+/).reverse();\n          var line = [];\n          var lineNumber = 0;\n          var lineHeight = 1.1;\n\n          var _x = text.attr(\"x\");\n\n          var _y = text.attr(\"y\");\n\n          var dy = 0;\n          var tspan = text.text(null).append(\"tspan\").attr(\"x\", _x).attr(\"y\", _y).attr(\"dy\", \"\".concat(dy, \"em\"));\n          /* eslint-disable no-cond-assign, no-plusplus */\n\n          while (word = words.pop()) {\n            line.push(word);\n            tspan.text(line.join(\" \"));\n\n            if (tspan.node().getComputedTextLength() > wrapwidth) {\n              line.pop();\n              tspan.text(line.join(\" \"));\n              line = [word];\n              tspan = text.append(\"tspan\").attr(\"x\", _x).attr(\"y\", _y).attr(\"dy\", \"\".concat(++lineNumber * lineHeight + dy, \"em\")).text(word);\n            }\n          }\n\n          titleLines = lineNumber * lineHeight;\n        });\n      }, width - titlePadding * 2);\n    }\n\n    var fontSize = parseFloat(getComputedStyle(_g.node()).fontSize);\n\n    _g.append(\"text\").attr(\"x\", 0).attr(\"dy\", title.length ? titlePadding * 2 + titleLines * fontSize : titlePadding * 1.25).attr(\"class\", \"sum\").text(data[data.length - 1].value.toLocaleString());\n  }\n}","map":{"version":3,"mappings":"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","names":["d3","areachart","opts","parseData","data","forEach","d","key","isoParse","value","Number","sort","x","y","ascending","aggregate","agg","map","item","index","array","title","objectName","container","select","showAxis","axis","ratio","split","reduce","a","b","showTooltip","Object","is","tip","undefined","cumulative","margin","top","right","bottom","left","width","node","getBoundingClientRect","height","titlePadding","min","scaleTime","range","scaleLinear","area","y0","y1","valueline","line","svg","append","attr","domain","extent","max","nice","topLine","circle","style","tooltip","id","on","x0","invert","mouse","i","bisector","d0","d1","coords","window","pageXOffset","pageYOffset","tooltipContent","timeFormat","toLocaleString","html","xAxis","axisBottom","ticks","timeMonth","tickFormat","tickSize","yAxis","axisLeft","_xAxis","g","call","remove","selectAll","_yAxis","length","text","titleLines","fulltext","wrapwidth","start","each","word","words","reverse","lineNumber","lineHeight","_x","_y","dy","tspan","pop","push","join","getComputedTextLength","fontSize","parseFloat","getComputedStyle"],"sources":["/home/injam/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/decidim-core-0.26.2/app/packs/src/decidim/vizzs/areachart.js"],"sourcesContent":["/* global d3 */\n/* eslint-disable require-jsdoc, id-length, no-undefined, no-unused-vars, multiline-ternary, no-ternary, no-nested-ternary, no-invalid-this */\n/* eslint prefer-reflect: [\"error\", { \"exceptions\": [\"call\"] }] */\n/* eslint dot-location: [\"error\", \"property\"] */\n/* eslint no-unused-vars: 0 */\n\nimport * as d3 from \"d3\";\n\n// lib\nexport default function areachart(opts = {}) {\n\n  const parseData = (data) => {\n    // format the data\n    data.forEach((d) => {\n      d.key = d3.isoParse(d.key)\n      d.value = Number(d.value)\n    });\n\n    // order by date\n    return data.sort((x, y) => d3.ascending(x.key, y.key))\n  }\n\n  // OPTIONAL: Helper function to accumulates all data values\n  const aggregate = (agg) => agg.map((item, index, array) => {\n    if (index > 0) {\n      item.value += array[index - 1].value\n    }\n    return item\n  })\n\n  // parse opts\n  let data = parseData(opts.data)\n  let title = opts.title\n  let objectName = opts.objectName || \"\"\n  let container = d3.select(opts.container)\n  let showAxis = opts.axis || false\n  let ratio = (opts.ratio || \"\").split(\":\").reduce((a, b) => a / b) || (4 / 3)\n  let showTooltip = Object.is(opts.tip, undefined) ? true : opts.tip\n  let cumulative = opts.agg || false\n\n  if (cumulative) {\n    data = aggregate(data)\n  }\n\n  // set the dimensions and margins of the graph\n  let margin = {\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0\n  }\n\n  let width = Number(container.node().getBoundingClientRect().width) - margin.left - margin.right\n  let height = (width / ratio) - margin.top - margin.bottom\n  let titlePadding = d3.min([width / 10, 32])\n\n  // set the ranges\n  let x = d3.scaleTime().range([0, width]);\n  let y = d3.scaleLinear().range([height, 0]);\n\n  // define the area\n  let area = d3.area()\n    .x((d) => x(d.key))\n    .y0(height)\n    .y1((d) => y(d.value));\n\n  // define the line\n  let valueline = d3.line()\n    .x((d) => x(d.key))\n    .y((d) => y(d.value));\n\n  let svg = container.append(\"svg\")\n    .attr(\"width\", width + margin.left + margin.right)\n    .attr(\"height\", height + margin.top + margin.bottom)\n    .append(\"g\")\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n  // scale the range of the data\n  x.domain(d3.extent(data, (d) => d.key));\n  y.domain([0, d3.max(data, (d) => d.value)]).nice();\n\n  // add the valueline path.\n  let topLine = svg.append(\"path\")\n    .data([data])\n    .attr(\"class\", \"line\")\n    .attr(\"d\", valueline)\n\n  // add the area\n  svg.append(\"path\")\n    .data([data])\n    .attr(\"class\", \"area\")\n    .attr(\"d\", area)\n\n  if (showTooltip) {\n    // tooltip\n    let circle = svg.append(\"circle\")\n      .attr(\"class\", \"circle\")\n      .attr(\"r\", 6)\n      .style(\"display\", \"none\")\n\n    let tooltip = d3.select(\"body\").append(\"div\")\n      .attr(\"id\", `${container.node().id}-tooltip`)\n      .attr(\"class\", \"chart-tooltip\")\n      .style(\"opacity\", 0)\n\n    svg\n      .on(\"mouseover\", () => {\n        circle.style(\"display\", null)\n        tooltip.style(\"opacity\", 1)\n      })\n      .on(\"mouseout\", () => {\n        circle.style(\"display\", \"none\")\n        tooltip.style(\"opacity\", 0)\n      })\n      .on(\"mousemove\", function() {\n        let x0 = x.invert(d3.mouse(this)[0])\n        let i = d3.bisector((d) => d.key).left(data, x0, 1)\n        let d0 = data[i - 1]\n        let d1 = data[i]\n        let d = (x0 - d0.key > d1.key - x0) ? d1 : d0\n\n        // svg position relative to document\n        let coords = {\n          x: window.pageXOffset + container.node().getBoundingClientRect().left,\n          y: window.pageYOffset + container.node().getBoundingClientRect().top\n        }\n\n        let tooltipContent = `\n          <div class=\"tooltip-content\">\n            ${d3.timeFormat(\"%e %B %Y\")(d.key)}<br />\n            ${d.value.toLocaleString()} ${objectName}\n          </div>`\n\n        circle.attr(\"transform\", `translate(${x(d.key)},${y(d.value)})`)\n        tooltip.html(tooltipContent)\n          .style(\"left\", `${coords.x + x(d.key)}px`)\n          .style(\"top\", `${coords.y + y(d.value)}px`)\n      })\n  }\n\n  if (showAxis) {\n    let xAxis = d3.axisBottom(x)\n      .ticks(d3.timeMonth)\n      .tickFormat(d3.timeFormat(\"%b %y\"))\n      .tickSize(-height)\n    let yAxis = d3.axisLeft(y)\n      .ticks(5)\n      .tickSize(8)\n\n    let _xAxis = (g) => {\n      g.call(xAxis)\n      g.select(\".domain\").remove()\n      g.selectAll(\".tick line\").attr(\"class\", \"dashed\")\n      g.selectAll(\".tick text\").attr(\"y\", 6)\n    }\n    let _yAxis = (g) => {\n      g.call(yAxis)\n      g.select(\".domain\").remove()\n      g.select(\".tick:first-of-type\").remove()\n      g.selectAll(\".tick text\").attr(\"text-anchor\", \"start\").attr(\"x\", 6)\n    }\n\n    // custom X-Axis\n    svg.append(\"g\")\n      .attr(\"transform\", `translate(0,${height})`)\n      .call(_xAxis);\n\n    // custom Y-Axis\n    svg.append(\"g\")\n      .call(_yAxis)\n\n    // last circle (current value)\n    let g = svg.append(\"g\")\n      .data([data])\n      .attr(\"transform\", (d) => `translate(${x(d[d.length - 1].key)},${y(d[d.length - 1].value)})`)\n\n    g.append(\"circle\")\n      .attr(\"class\", \"circle\")\n      .attr(\"r\", 8)\n\n    g.append(\"text\")\n      .attr(\"class\", \"sum\")\n      .attr(\"text-anchor\", \"end\")\n      .attr(\"dx\", -8 * 2)\n      .text((d) => d[d.length - 1].value.toLocaleString())\n\n  } else {\n    // add the title group\n    let g = svg.append(\"g\")\n      .attr(\"text-anchor\", \"start\")\n      .attr(\"transform\", `translate(${titlePadding},${titlePadding})`)\n\n    let titleLines = 0\n\n    if (title.length) {\n      g.append(\"text\")\n        .attr(\"x\", 0)\n        .attr(\"y\", 0)\n        .attr(\"class\", \"title\")\n        .text(title)\n        .call(function(fulltext, wrapwidth, start = 0) {\n          fulltext.each(function() {\n            let text = d3.select(this)\n            let word = \"\"\n            let words = text.text().split(/\\s+/).reverse()\n            let line = []\n            let lineNumber = 0\n            let lineHeight = 1.1\n            let _x = text.attr(\"x\")\n            let _y = text.attr(\"y\")\n            let dy = 0\n            let tspan = text.text(null)\n              .append(\"tspan\")\n              .attr(\"x\", _x)\n              .attr(\"y\", _y)\n              .attr(\"dy\", `${dy}em`)\n\n            /* eslint-disable no-cond-assign, no-plusplus */\n            while (word = words.pop()) {\n              line.push(word);\n              tspan.text(line.join(\" \"));\n              if (tspan.node().getComputedTextLength() > wrapwidth) {\n                line.pop()\n                tspan.text(line.join(\" \"))\n                line = [word]\n                tspan = text.append(\"tspan\")\n                  .attr(\"x\", _x)\n                  .attr(\"y\", _y)\n                  .attr(\"dy\", `${(++lineNumber * lineHeight) + dy}em`)\n                  .text(word);\n              }\n            }\n\n            titleLines = lineNumber * lineHeight\n          });\n        }, width - (titlePadding * 2))\n    }\n\n    let fontSize = parseFloat(getComputedStyle(g.node()).fontSize);\n\n    g.append(\"text\")\n      .attr(\"x\", 0)\n      .attr(\"dy\", title.length ? (titlePadding * 2) + (titleLines * fontSize) : (titlePadding * 1.25))\n      .attr(\"class\", \"sum\")\n      .text(data[data.length - 1].value.toLocaleString())\n  }\n}\n"]},"metadata":{},"sourceType":"module"}