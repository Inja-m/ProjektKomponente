{"ast":null,"code":"/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\";\n\nvar updateSubmitButton = function updateSubmitButton($fieldContainer, $selectedItems) {\n  var $form = $fieldContainer.closest(\"form\");\n\n  if ($form.length < 1) {\n    return;\n  }\n\n  var $submitButton = $form.find(\"button[type='submit']\");\n\n  if ($selectedItems.children().length === 0) {\n    $submitButton.prop(\"disabled\", true);\n  } else {\n    $submitButton.prop(\"disabled\", false);\n  }\n};\n\n$(function () {\n  var $multipleMentionContainer = $(\".js-multiple-mentions\");\n  var $multipleMentionRecipientsContainer = $(\".js-multiple-mentions-recipients\");\n  var nodatafound = $multipleMentionContainer.attr(\"data-noresults\");\n  var directMessageDisabled = $multipleMentionContainer.attr(\"data-direct-messages-disabled\");\n  var maxRecipients = 9;\n  var mentionsCount = 0;\n  /* eslint no-unused-vars: 0 */\n\n  var deleteRecipient = function deleteRecipient(element) {\n    // Remove recipient\n    element.remove();\n    mentionsCount -= 1; // In case mentions container disable, enable again\n\n    if ($multipleMentionContainer.prop(\"disabled\")) {\n      $multipleMentionContainer.prop(\"disabled\", false);\n    }\n  };\n\n  var noMatchTemplate = null;\n\n  if (nodatafound) {\n    noMatchTemplate = function noMatchTemplate() {\n      return \"<li>\".concat(nodatafound, \"</li>\");\n    };\n  } // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n\n  /* eslint no-invalid-this: 0 */\n\n  /* eslint consistent-this: 0 */\n\n  /* eslint prefer-reflect: 0 */\n\n\n  var debounce = function debounce(callback, wait) {\n    var _this = this;\n\n    var timeout = null;\n    return function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var context = _this;\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        return callback.apply(context, args);\n      }, wait);\n    };\n  };\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n\n  /* eslint no-unused-expressions: 0 */\n\n\n  var remoteSearch = function remoteSearch(text, cb) {\n    var exclusionIds = [];\n    $multipleMentionRecipientsContainer.find(\"input[name^='recipient_id']\").each(function (index) {\n      exclusionIds.push($(this).val());\n    });\n    var query = \"{users(filter:{wildcard:\\\"\".concat(text, \"\\\",excludeIds:[\").concat(exclusionIds, \"]}){id,nickname,name,avatarUrl,__typename,...on UserGroup{membersCount},...on User{directMessagesEnabled}}}\");\n    $.post(\"/api\", {\n      query: query\n    }).then(function (response) {\n      var data = response.data.users || {};\n      cb(data);\n    }).fail(function () {\n      cb([]);\n    }).always(function () {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n      var $parent = $(tribute.current.element).parent();\n      $parent.addClass(\"is-active\"); // We need to move the container to the wrapper selected\n\n      var $tribute = $parent.find(\".tribute-container\"); // Remove the inline styles, relative to absolute positioning\n\n      $tribute.removeAttr(\"style\");\n    });\n  }; // tribute.js docs - http://github.com/zurb/tribute\n\n  /* global Tribute*/\n\n  /* eslint multiline-ternary: 0 */\n\n  /* eslint no-ternary: 0 */\n\n\n  var tribute = new Tribute({\n    autocompleteMode: true,\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, function (users) {\n        return cb(users);\n      });\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    menuItemLimit: 10,\n    fillAttr: \"nickname\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: function lookup(item) {\n      return item.nickname + item.name;\n    },\n    selectTemplate: function selectTemplate(item) {\n      mentionsCount += 1;\n\n      if (mentionsCount >= maxRecipients) {\n        $multipleMentionContainer.prop(\"disabled\", true);\n      }\n\n      if (typeof item === \"undefined\") {\n        return null;\n      } // Set recipient profile view\n\n\n      var recipientLabel = \"\\n        <label style=\\\"padding: 0 0 10px 0\\\">\\n          <img src=\\\"\".concat(item.original.avatarUrl, \"\\\" alt=\\\"\").concat(item.original.name, \"\\\" height=\\\"35\\\" width=\\\"35\\\" style=\\\"border-radius: 50%;\\\" aria-label=\\\"\").concat(item.original.name, \"\\\">&nbsp;\\n          <b>\").concat(item.original.name, \"</b>\\n          <input type=\\\"hidden\\\" name=\\\"recipient_id[]\\\" value=\\\"\").concat(item.original.id, \"\\\">\\n          <div class=\\\"float-right\\\">&times;</div>\\n        </label>\\n      \"); // Append new recipient to DOM\n\n      if (item.original.__typename === \"UserGroup\" || item.original.directMessagesEnabled === \"true\") {\n        $multipleMentionRecipientsContainer.append($(recipientLabel));\n        $multipleMentionContainer.val(\"\");\n      } // In order to add tabindex accessibility control to each recipient in list\n\n\n      $multipleMentionRecipientsContainer.find(\"label\").each(function (index) {\n        $(this).find(\"div\").attr(\"tabIndex\", 0).attr(\"aria-controls\", 0).attr(\"aria-label\", \"Close\").attr(\"role\", \"tab\");\n      });\n      updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer); // Clean input\n\n      return \"\";\n    },\n    menuItemTemplate: function menuItemTemplate(item) {\n      var svg = \"\";\n      var enabled = item.original.directMessagesEnabled === \"true\";\n\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        enabled = true;\n        var iconsPath = window.Decidim.config.get(\"icons_path\");\n        svg = \"<span class=\\\"is-group\\\">\".concat(item.original.membersCount, \"x <svg class=\\\"icon--members icon\\\"><use href=\\\"\").concat(iconsPath, \"#icon-members\\\"/></svg></span>\");\n      }\n\n      var disabledElementClass = enabled ? \"\" : \"disabled-tribute-element\";\n      var disabledElementMessage = enabled ? \"\" : \"&nbsp;<span class=\\\"disabled-tribute-element-info\\\">\".concat(directMessageDisabled, \"</span>\");\n      return \"<div class=\\\"tribute-item \".concat(item.original.__typename, \" \").concat(disabledElementClass, \"\\\">\\n      <span class=\\\"author__avatar\\\"><img src=\\\"\").concat(item.original.avatarUrl, \"\\\" alt=\\\"author-avatar\\\"></span>\\n        <strong>\").concat(item.original.nickname, \"</strong>\\n        <small>\").concat(item.original.name, \"</small>\\n        \").concat(svg, \"\\n        \").concat(disabledElementMessage, \"\\n      </div>\");\n    }\n  });\n\n  var setupEvents = function setupEvents($element) {\n    updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer); // DOM manipulation\n\n    $element.on(\"focusin\", function (event) {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", function (event) {\n      var $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        var $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent); // Remove the inline styles, relative to absolute positioning\n\n        $tribute.removeAttr(\"style\"); // Parent adaptation\n\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  var setupRecipientEvents = function setupRecipientEvents($element) {\n    // Allow delete with click on element in recipients list\n    $element.on(\"click\", function (event) {\n      var $target = event.target.parentNode;\n\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n        updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer);\n      }\n    }); // Allow delete with keypress on element in recipients list\n\n    $element.on(\"keypress\", function (event) {\n      var $target = event.target.parentNode;\n\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n        updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer);\n      }\n    });\n  }; // Call only if we have containter to bind events to\n\n\n  if ($multipleMentionContainer.length) {\n    setupEvents($multipleMentionContainer);\n    tribute.attach($multipleMentionContainer);\n  } // Call only if we have containter to bind events to\n\n\n  if ($multipleMentionRecipientsContainer.length) {\n    setupRecipientEvents($multipleMentionRecipientsContainer);\n  }\n});","map":{"version":3,"mappings":"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","names":["Tribute","updateSubmitButton","$fieldContainer","$selectedItems","$form","closest","length","$submitButton","find","children","prop","$","$multipleMentionContainer","$multipleMentionRecipientsContainer","nodatafound","attr","directMessageDisabled","maxRecipients","mentionsCount","deleteRecipient","element","remove","noMatchTemplate","debounce","callback","wait","timeout","args","arguments","context","_this","clearTimeout","setTimeout","apply","remoteSearch","text","cb","exclusionIds","each","index","push","val","query","post","then","response","data","users","fail","always","$parent","tribute","current","parent","addClass","$tribute","removeAttr","autocompleteMode","values","positionMenu","menuContainer","menuItemLimit","fillAttr","lookup","item","nickname","name","selectTemplate","recipientLabel","original","avatarUrl","id","__typename","directMessagesEnabled","append","menuItemTemplate","svg","enabled","window","Decidim","iconsPath","config","get","membersCount","disabledElementClass","disabledElementMessage","setupEvents","$element","on","event","target","parentNode","hasClass","removeClass","isActive","appendTo","setupRecipientEvents","$target","tagName","attach"],"sources":["/home/injam/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/decidim-core-0.26.2/app/packs/src/decidim/input_multiple_mentions.js"],"sourcesContent":["/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\"\n\nconst updateSubmitButton = ($fieldContainer, $selectedItems) => {\n  const $form = $fieldContainer.closest(\"form\");\n  if ($form.length < 1) {\n    return;\n  }\n\n  const $submitButton = $form.find(\"button[type='submit']\");\n  if ($selectedItems.children().length === 0) {\n    $submitButton.prop(\"disabled\", true);\n  } else {\n    $submitButton.prop(\"disabled\", false);\n  }\n}\n\n$(() => {\n  const $multipleMentionContainer = $(\".js-multiple-mentions\");\n  const $multipleMentionRecipientsContainer = $(\".js-multiple-mentions-recipients\");\n  const nodatafound = $multipleMentionContainer.attr(\"data-noresults\");\n  const directMessageDisabled = $multipleMentionContainer.attr(\"data-direct-messages-disabled\");\n\n  const maxRecipients = 9;\n  let mentionsCount = 0;\n\n  /* eslint no-unused-vars: 0 */\n  let deleteRecipient = function(element) {\n    // Remove recipient\n    element.remove();\n    mentionsCount -= 1;\n    // In case mentions container disable, enable again\n    if ($multipleMentionContainer.prop(\"disabled\")) {\n      $multipleMentionContainer.prop(\"disabled\", false);\n    }\n  };\n\n  let noMatchTemplate = null\n  if (nodatafound) {\n    noMatchTemplate = () => `<li>${nodatafound}</li>`;\n  }\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds\n  /* eslint no-invalid-this: 0 */\n  /* eslint consistent-this: 0 */\n  /* eslint prefer-reflect: 0 */\n  const debounce = function(callback, wait) {\n    let timeout = null;\n    return (...args) => {\n      const context = this;\n      clearTimeout(timeout);\n      timeout = setTimeout(() => callback.apply(context, args), wait);\n    };\n  }\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  /* eslint no-unused-expressions: 0 */\n  let remoteSearch = function(text, cb) {\n    let exclusionIds = [];\n    $multipleMentionRecipientsContainer.find(\"input[name^='recipient_id']\").each(function(index) {\n      exclusionIds.push($(this).val());\n    });\n    let query = `{users(filter:{wildcard:\"${text}\",excludeIds:[${exclusionIds}]}){id,nickname,name,avatarUrl,__typename,...on UserGroup{membersCount},...on User{directMessagesEnabled}}}`;\n    $.post(\"/api\", {query: query}).\n      then((response) => {\n        let data = response.data.users || {};\n        cb(data)\n      }).fail(function() {\n        cb([])\n      }).always(() => {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n        const $parent = $(tribute.current.element).parent();\n        $parent.addClass(\"is-active\");\n\n        // We need to move the container to the wrapper selected\n        const $tribute = $parent.find(\".tribute-container\");\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n      })\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  /* eslint multiline-ternary: 0 */\n  /* eslint no-ternary: 0 */\n  let tribute = new Tribute({\n    autocompleteMode: true,\n    // avoid overloading the API if the user types too fast\n    values: debounce(function (text, cb) {\n      remoteSearch(text, (users) => cb(users));\n    }, 250),\n    positionMenu: true,\n    menuContainer: null,\n    menuItemLimit: 10,\n    fillAttr: \"nickname\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: (item) => item.nickname + item.name,\n    selectTemplate: function(item) {\n      mentionsCount += 1;\n      if (mentionsCount >= maxRecipients) {\n        $multipleMentionContainer.prop(\"disabled\", true);\n      }\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      // Set recipient profile view\n      let recipientLabel = `\n        <label style=\"padding: 0 0 10px 0\">\n          <img src=\"${item.original.avatarUrl}\" alt=\"${item.original.name}\" height=\"35\" width=\"35\" style=\"border-radius: 50%;\" aria-label=\"${item.original.name}\">&nbsp;\n          <b>${item.original.name}</b>\n          <input type=\"hidden\" name=\"recipient_id[]\" value=\"${item.original.id}\">\n          <div class=\"float-right\">&times;</div>\n        </label>\n      `;\n\n      // Append new recipient to DOM\n      if (item.original.__typename === \"UserGroup\" || item.original.directMessagesEnabled === \"true\") {\n        $multipleMentionRecipientsContainer.append($(recipientLabel));\n        $multipleMentionContainer.val(\"\");\n      }\n\n      // In order to add tabindex accessibility control to each recipient in list\n      $multipleMentionRecipientsContainer.find(\"label\").each(function(index) {\n        $(this).find(\"div\").attr(\"tabIndex\", 0).attr(\"aria-controls\", 0).attr(\"aria-label\", \"Close\").attr(\"role\", \"tab\");\n      });\n\n      updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer);\n      // Clean input\n      return \"\";\n    },\n    menuItemTemplate: function(item) {\n      let svg = \"\";\n      let enabled = item.original.directMessagesEnabled === \"true\";\n      if (window.Decidim && item.original.__typename === \"UserGroup\") {\n        enabled = true;\n        const iconsPath = window.Decidim.config.get(\"icons_path\");\n        svg = `<span class=\"is-group\">${item.original.membersCount}x <svg class=\"icon--members icon\"><use href=\"${iconsPath}#icon-members\"/></svg></span>`;\n      }\n      let disabledElementClass = enabled ? \"\" : \"disabled-tribute-element\";\n      let disabledElementMessage = enabled ? \"\" : `&nbsp;<span class=\"disabled-tribute-element-info\">${directMessageDisabled}</span>`;\n      return `<div class=\"tribute-item ${item.original.__typename} ${disabledElementClass}\">\n      <span class=\"author__avatar\"><img src=\"${item.original.avatarUrl}\" alt=\"author-avatar\"></span>\n        <strong>${item.original.nickname}</strong>\n        <small>${item.original.name}</small>\n        ${svg}\n        ${disabledElementMessage}\n      </div>`;\n    }\n  });\n\n  let setupEvents = function($element) {\n    updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer);\n\n    // DOM manipulation\n    $element.on(\"focusin\", (event) => {\n      // Set the parent container relative to the current element\n      tribute.menuContainer = event.target.parentNode;\n    });\n    $element.on(\"focusout\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if ($parent.hasClass(\"is-active\")) {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n    $element.on(\"input\", (event) => {\n      let $parent = $(event.target).parent();\n\n      if (tribute.isActive) {\n        // We need to move the container to the wrapper selected\n        let $tribute = $(\".tribute-container\");\n        $tribute.appendTo($parent);\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n        // Parent adaptation\n        $parent.addClass(\"is-active\");\n      } else {\n        $parent.removeClass(\"is-active\");\n      }\n    });\n  };\n\n  let setupRecipientEvents = function($element) {\n    // Allow delete with click on element in recipients list\n    $element.on(\"click\", (event) => {\n      let $target = event.target.parentNode;\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n        updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer);\n      }\n    });\n    // Allow delete with keypress on element in recipients list\n    $element.on(\"keypress\", (event) => {\n      let $target = event.target.parentNode;\n      if ($target.tagName === \"LABEL\") {\n        deleteRecipient($target);\n        updateSubmitButton($multipleMentionContainer, $multipleMentionRecipientsContainer);\n      }\n    });\n  };\n\n  // Call only if we have containter to bind events to\n  if ($multipleMentionContainer.length) {\n    setupEvents($multipleMentionContainer);\n    tribute.attach($multipleMentionContainer);\n  }\n\n  // Call only if we have containter to bind events to\n  if ($multipleMentionRecipientsContainer.length) {\n    setupRecipientEvents($multipleMentionRecipientsContainer);\n  }\n});\n"]},"metadata":{},"sourceType":"module"}