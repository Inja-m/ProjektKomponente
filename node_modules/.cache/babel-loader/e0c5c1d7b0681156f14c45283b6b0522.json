{"ast":null,"code":"function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nimport * as L from \"leaflet\";\n\nvar ControlsUI = /*#__PURE__*/function () {\n  function ControlsUI(awesomeMap) {\n    var _this = this;\n\n    _classCallCheck(this, ControlsUI);\n\n    this.awesomeMap = awesomeMap;\n    this.main = L.control.layers(null, null, {\n      position: \"topleft\",\n      sortLayers: false,\n      collapsed: this.awesomeMap.config.collapsedMenu // hideSingleBase: true\n\n    });\n\n    if (this.awesomeMap.config.hideControls) {\n      $(this.main.getContainer()).hide();\n    }\n\n    this.$loading = $(\"#awesome-map .loading-spinner\");\n    this.onHashtag = this._orderHashtags;\n    this.awesomeMap.map.on(\"overlayadd\", function () {\n      _this.removeHiddenCategories();\n    });\n  }\n\n  _createClass(ControlsUI, [{\n    key: \"attach\",\n    value: function attach() {\n      var _this2 = this; // legends\n\n\n      this.main.addTo(this.awesomeMap.map);\n      this.addSearchControls();\n\n      if (this.awesomeMap.config.menu.categories) {\n        this.addCategoriesControls();\n      } // sub-layer hashtag title toggle\n\n\n      $(\"#awesome-map\").on(\"click\", \".awesome_map-title-control\", function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $(\"#awesome_map-categories-control\").toggleClass(\"active\");\n        $(\"#awesome_map-hashtags-control\").toggleClass(\"active\");\n      }); // hashtag events\n\n      $(\"#awesome-map\").on(\"change\", \".awesome_map-hashtags-selector\", function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        var tag = $(e.target).closest(\"label\").data(\"layer\"); // console.log(\"changed, layer\", tag, \"checked\", e.target.checked, e);\n\n        if (tag) {\n          _this2.updateHashtagLayers();\n        }\n      }); // select/deselect all tags\n\n      $(\"#awesome-map\").on(\"click\", \".awesome_map-toggle_all_tags\", function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        $(\"#awesome-map .awesome_map-hashtags-selector\").prop(\"checked\", $(\"#awesome-map .awesome_map-hashtags-selector:checked\").length < $(\"#awesome-map .awesome_map-hashtags-selector\").length);\n\n        _this2.updateHashtagLayers();\n      });\n    }\n  }, {\n    key: \"addSearchControls\",\n    value: function addSearchControls() {\n      $(this.main.getContainer()).contents(\"form\").append(\"<div id=\\\"awesome_map-categories-control\\\" class=\\\"active\\\"><b class=\\\"awesome_map-title-control\\\">\".concat(window.DecidimAwesome.texts.categories, \"</b><div class=\\\"categories-container\\\"></div></div>\\n    <div id=\\\"awesome_map-hashtags-control\\\"><b class=\\\"awesome_map-title-control\\\">\").concat(window.DecidimAwesome.texts.hashtags, \"</b><div class=\\\"hashtags-container\\\"></div><a href=\\\"#\\\" class=\\\"awesome_map-toggle_all_tags\\\">\").concat(window.DecidimAwesome.texts.select_deselect_all, \"</a></div>\"));\n    }\n  }, {\n    key: \"addCategoriesControls\",\n    value: function addCategoriesControls() {\n      var _this3 = this;\n\n      this.awesomeMap.categories.forEach(function (category) {\n        // add control layer for this category\n        var label = \"<i class=\\\"awesome_map-category_\".concat(category.id, \"\\\"></i> \").concat(category.name);\n        _this3.awesomeMap.layers[category.id] = {\n          label: label,\n          group: new L.FeatureGroup.SubGroup(_this3.awesomeMap.cluster)\n        };\n\n        _this3.awesomeMap.layers[category.id].group.addTo(_this3.awesomeMap.map);\n\n        $(\"#awesome_map-categories-control .categories-container\").append(\"<label data-layer=\\\"\".concat(category.id, \"\\\" class=\\\"awesome_map-category-\").concat(category.id).concat(category.parent ? \" subcategory\" : \"\", \"\\\" data-parent=\\\"\").concat(category.parent, \"\\\"><input type=\\\"checkbox\\\" class=\\\"awesome_map-categories-selector\\\" checked><span>\").concat(label, \"</span></label>\"));\n      }); // category events\n\n      $(\"#awesome-map\").on(\"change\", \".awesome_map-categories-selector\", function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        var id = $(e.target).closest(\"label\").data(\"layer\");\n\n        var cat = _this3.awesomeMap.getCategory(id); // console.log(\"changed, layer\", id, \"cat\", cat, \"checked\", e.target.checked, e);\n\n\n        if (cat) {\n          var layer = _this3.awesomeMap.layers[cat.id];\n\n          if (e.target.checked) {\n            // show group of markers\n            _this3.awesomeMap.map.addLayer(layer.group);\n          } else {\n            // hide group of markers\n            _this3.awesomeMap.map.removeLayer(layer.group); // cat.children().forEach((c) => {\n            //   let $el = $(`.awesome_map-category-${c.id}`);\n            //   if($el.contents(\"input\").prop(\"checked\")) {\n            //     $el.click();\n            //   }\n            // });\n\n          } // if it's a children, put the parent to indeterminate\n\n\n          _this3._indeterminateParentInput(cat); // sync tags\n\n\n          _this3.updateHashtagLayers();\n        }\n      });\n    } // Hashtags are collected directly from proposals (this is different than categories)\n\n  }, {\n    key: \"addHashtagsControls\",\n    value: function addHashtagsControls(hashtags, marker) {\n      var _this4 = this; // show hashtag layer\n\n\n      if (hashtags && hashtags.length) {\n        $(\"#awesome_map-hashtags-control\").show();\n        hashtags.forEach(function (hashtag) {\n          // Add layer if not exists, otherwise just add the marker to the group\n          if (!_this4.awesomeMap.layers[hashtag.tag]) {\n            _this4.awesomeMap.layers[hashtag.tag] = {\n              label: hashtag.name,\n              group: new L.FeatureGroup.SubGroup(_this4.awesomeMap.cluster)\n            };\n\n            _this4.awesomeMap.map.addLayer(_this4.awesomeMap.layers[hashtag.tag].group);\n\n            $(\"#awesome_map-hashtags-control .hashtags-container\").append(\"<label data-layer=\\\"\".concat(hashtag.tag, \"\\\" class=\\\"awesome_map-hashtag-\").concat(hashtag.tag, \"\\\"><input type=\\\"checkbox\\\" class=\\\"awesome_map-hashtags-selector\\\" checked><span>\").concat(hashtag.name, \"</span></label>\")); // Call a trigger, might be in service for customizations\n\n            _this4.onHashtag(hashtag, $(\"#awesome_map-hashtags-control .hashtags-container\"));\n          }\n\n          _this4.awesomeMap.layers[hashtag.tag].group.addLayer(marker);\n\n          var $label = $(\"label.awesome_map-hashtag-\".concat(hashtag.tag)); // update number of items\n\n          $label.attr(\"title\", \"\".concat(parseInt($label.attr(\"title\") || 0) + 1, \" \").concat(window.DecidimAwesome.texts.items));\n        });\n      }\n    }\n  }, {\n    key: \"showCategory\",\n    value: function showCategory(cat) {\n      $(\"#awesome_map-categories-control\").show(); // show category if hidden\n\n      var $label = $(\"label.awesome_map-category-\".concat(cat.id));\n      var $parent = $(\"label.awesome_map-category-\".concat(cat.parent));\n      $label.show(); // update number of items\n\n      $label.attr(\"title\", \"\".concat(parseInt($label.attr(\"title\") || 0) + 1, \" \").concat(window.DecidimAwesome.texts.items)); // show parent if apply\n\n      $parent.show();\n      $parent.attr(\"title\", \"\".concat(parseInt($parent.attr(\"title\") || 0) + 1, \" \").concat(window.DecidimAwesome.texts.items));\n    }\n  }, {\n    key: \"removeHiddenComponents\",\n    value: function removeHiddenComponents() {\n      var _this5 = this;\n\n      $(\".awesome_map-component\").each(function (_idx, el) {\n        var layer = _this5.awesomeMap.layers[$(el).data(\"layer\")];\n\n        var $input = $(el).closest(\"div\").find(\"input:not(:checked)\");\n\n        if (layer && $input.length) {\n          _this5.awesomeMap.map.addLayer(layer.group);\n\n          _this5.awesomeMap.map.removeLayer(layer.group);\n        }\n      });\n    }\n  }, {\n    key: \"removeHiddenCategories\",\n    value: function removeHiddenCategories() {\n      var _this6 = this;\n\n      $(\".awesome_map-categories-selector:not(:checked)\").each(function (_idx, el) {\n        var layer = _this6.awesomeMap.layers[$(el).closest(\"label\").data(\"layer\")];\n\n        if (layer) {\n          _this6.awesomeMap.map.addLayer(layer.group);\n\n          _this6.awesomeMap.map.removeLayer(layer.group);\n        }\n      });\n    }\n  }, {\n    key: \"updateHashtagLayers\",\n    value: function updateHashtagLayers() {\n      var _this7 = this; // hide all\n\n\n      $(\".awesome_map-hashtags-selector\").each(function (_idx, el) {\n        var layer = _this7.awesomeMap.layers[$(el).closest(\"label\").data(\"layer\")];\n\n        if (layer) {\n          _this7.awesomeMap.map.removeLayer(layer.group);\n        }\n      }); // show selected only\n\n      $(\".awesome_map-hashtags-selector:checked\").each(function (_idx, el) {\n        var layer = _this7.awesomeMap.layers[$(el).closest(\"label\").data(\"layer\")];\n\n        if (layer) {\n          _this7.awesomeMap.map.addLayer(layer.group);\n        }\n      }); // hide non-selected categories\n\n      this.removeHiddenComponents();\n      this.removeHiddenCategories();\n    }\n  }, {\n    key: \"updateStats\",\n    value: function updateStats(uid, total) {\n      // update component stats\n      var $component = $(\"#awesome_map-\".concat(uid));\n      $component.attr(\"title\", \"\".concat(total, \" \").concat(window.DecidimAwesome.texts.items));\n    }\n  }, {\n    key: \"_indeterminateParentInput\",\n    value: function _indeterminateParentInput(cat) {\n      if (cat.parent) {\n        var $input = $(\".awesome_map-category-\".concat(cat.parent)).contents(\"input\");\n        var $subcats = $(\"[class^=\\\"awesome_map-category-\\\"][data-parent=\\\"\".concat(cat.parent, \"\\\"]:visible\"));\n        var num_checked = $subcats.contents(\"input:checked\").length;\n        $input.prop(\"indeterminate\", num_checked != $subcats.length && num_checked != 0);\n      }\n    } // order hashtags alphabetically\n\n  }, {\n    key: \"_orderHashtags\",\n    value: function _orderHashtags(_hashtag, $div) {\n      var $last = $div.contents(\"label:last\");\n\n      if ($last.prev(\"label\").length) {\n        // move the label to order it alphabetically\n        $div.contents(\"label\").each(function (_idx, el) {\n          if ($(el).text().localeCompare($last.text()) > 0) {\n            $(el).before($last);\n            return false;\n          }\n        });\n      }\n    }\n  }]);\n\n  return ControlsUI;\n}();\n\nexport { ControlsUI as default };","map":{"version":3,"mappings":"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","names":["L","ControlsUI","awesomeMap","_classCallCheck","main","control","layers","position","sortLayers","collapsed","config","collapsedMenu","hideControls","$","getContainer","hide","$loading","onHashtag","_orderHashtags","map","on","_this","removeHiddenCategories","addTo","addSearchControls","menu","categories","addCategoriesControls","e","preventDefault","stopPropagation","toggleClass","tag","target","closest","data","_this2","updateHashtagLayers","prop","length","contents","append","window","DecidimAwesome","texts","hashtags","select_deselect_all","forEach","category","label","id","name","_this3","group","FeatureGroup","SubGroup","cluster","parent","cat","getCategory","layer","checked","addLayer","removeLayer","_indeterminateParentInput","marker","show","hashtag","_this4","$label","attr","parseInt","items","$parent","each","_idx","el","_this5","$input","find","_this6","_this7","removeHiddenComponents","uid","total","$component","$subcats","num_checked","_hashtag","$div","$last","prev","text","localeCompare","before"],"sources":["/home/injam/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/decidim-decidim_awesome-0.8.3/app/packs/src/decidim/decidim_awesome/awesome_map/controls_ui.js"],"sourcesContent":["import * as L from \"leaflet\";\n\nexport default class ControlsUI {\n  constructor(awesomeMap) {\n    this.awesomeMap = awesomeMap;\n\n    this.main = L.control.layers(null, null, {\n      position: \"topleft\",\n      sortLayers: false,\n      collapsed: this.awesomeMap.config.collapsedMenu\n      // hideSingleBase: true\n    });\n\n    if (this.awesomeMap.config.hideControls) {\n      $(this.main.getContainer()).hide();\n    }\n\n    this.$loading = $(\"#awesome-map .loading-spinner\");\n    this.onHashtag = this._orderHashtags;\n\n    this.awesomeMap.map.on(\"overlayadd\", () => {\n      this.removeHiddenCategories();\n    });\n  }\n\n  attach() {\n    // legends\n    this.main.addTo(this.awesomeMap.map);\n\n    this.addSearchControls();\n    if (this.awesomeMap.config.menu.categories) {\n      this.addCategoriesControls();\n    }\n\n    // sub-layer hashtag title toggle\n    $(\"#awesome-map\").on(\"click\", \".awesome_map-title-control\", (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      $(\"#awesome_map-categories-control\").toggleClass(\"active\");\n      $(\"#awesome_map-hashtags-control\").toggleClass(\"active\");\n    });\n\n    // hashtag events\n    $(\"#awesome-map\").on(\"change\", \".awesome_map-hashtags-selector\", (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      const tag = $(e.target).closest(\"label\").data(\"layer\");\n      // console.log(\"changed, layer\", tag, \"checked\", e.target.checked, e);\n      if (tag) {\n        this.updateHashtagLayers();\n      }\n    });\n\n    // select/deselect all tags\n    $(\"#awesome-map\").on(\"click\", \".awesome_map-toggle_all_tags\", (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      $(\"#awesome-map .awesome_map-hashtags-selector\").prop(\"checked\", $(\"#awesome-map .awesome_map-hashtags-selector:checked\").length < $(\"#awesome-map .awesome_map-hashtags-selector\").length);\n      this.updateHashtagLayers();\n    });\n  }\n\n  addSearchControls() {\n    $(this.main.getContainer()).contents(\"form\").append(`<div id=\"awesome_map-categories-control\" class=\"active\"><b class=\"awesome_map-title-control\">${window.DecidimAwesome.texts.categories}</b><div class=\"categories-container\"></div></div>\n    <div id=\"awesome_map-hashtags-control\"><b class=\"awesome_map-title-control\">${window.DecidimAwesome.texts.hashtags}</b><div class=\"hashtags-container\"></div><a href=\"#\" class=\"awesome_map-toggle_all_tags\">${window.DecidimAwesome.texts.select_deselect_all}</a></div>`);\n  }\n\n  addCategoriesControls() {\n    this.awesomeMap.categories.forEach((category) => {\n      // add control layer for this category\n      const label = `<i class=\"awesome_map-category_${category.id}\"></i> ${category.name}`;\n      this.awesomeMap.layers[category.id] = {\n        label: label,\n        group: new L.FeatureGroup.SubGroup(this.awesomeMap.cluster)\n      };\n      this.awesomeMap.layers[category.id].group.addTo(this.awesomeMap.map);\n      $(\"#awesome_map-categories-control .categories-container\").append(`<label data-layer=\"${category.id}\" class=\"awesome_map-category-${category.id}${category.parent\n        ? \" subcategory\"\n        : \"\"}\" data-parent=\"${category.parent}\"><input type=\"checkbox\" class=\"awesome_map-categories-selector\" checked><span>${label}</span></label>`);\n    })\n\n    // category events\n    $(\"#awesome-map\").on(\"change\", \".awesome_map-categories-selector\", (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const id = $(e.target).closest(\"label\").data(\"layer\");\n      const cat = this.awesomeMap.getCategory(id);\n      // console.log(\"changed, layer\", id, \"cat\", cat, \"checked\", e.target.checked, e);\n      if (cat) {\n        const layer = this.awesomeMap.layers[cat.id];\n        if (e.target.checked) {\n          // show group of markers\n          this.awesomeMap.map.addLayer(layer.group);\n        } else {\n          // hide group of markers\n          this.awesomeMap.map.removeLayer(layer.group);\n          // cat.children().forEach((c) => {\n          //   let $el = $(`.awesome_map-category-${c.id}`);\n          //   if($el.contents(\"input\").prop(\"checked\")) {\n          //     $el.click();\n          //   }\n          // });\n        }\n        // if it's a children, put the parent to indeterminate\n        this._indeterminateParentInput(cat);\n        // sync tags\n        this.updateHashtagLayers();\n      }\n    });\n  }\n\n  // Hashtags are collected directly from proposals (this is different than categories)\n  addHashtagsControls(hashtags, marker) {\n    // show hashtag layer\n    if (hashtags && hashtags.length) {\n      $(\"#awesome_map-hashtags-control\").show();\n      hashtags.forEach((hashtag) => {\n        // Add layer if not exists, otherwise just add the marker to the group\n        if (!this.awesomeMap.layers[hashtag.tag]) {\n          this.awesomeMap.layers[hashtag.tag] = {\n            label: hashtag.name,\n            group: new L.FeatureGroup.SubGroup(this.awesomeMap.cluster)\n          };\n          this.awesomeMap.map.addLayer(this.awesomeMap.layers[hashtag.tag].group);\n          $(\"#awesome_map-hashtags-control .hashtags-container\").append(`<label data-layer=\"${hashtag.tag}\" class=\"awesome_map-hashtag-${hashtag.tag}\"><input type=\"checkbox\" class=\"awesome_map-hashtags-selector\" checked><span>${hashtag.name}</span></label>`);\n          // Call a trigger, might be in service for customizations\n          this.onHashtag(hashtag, $(\"#awesome_map-hashtags-control .hashtags-container\"));\n        }\n        this.awesomeMap.layers[hashtag.tag].group.addLayer(marker);\n\n        const $label = $(`label.awesome_map-hashtag-${hashtag.tag}`);\n        // update number of items\n        $label.attr(\"title\", `${parseInt($label.attr(\"title\") || 0) + 1} ${window.DecidimAwesome.texts.items}`);\n      });\n    }\n  }\n\n  showCategory(cat) {\n    $(\"#awesome_map-categories-control\").show();\n    // show category if hidden\n    const $label = $(`label.awesome_map-category-${cat.id}`);\n    const $parent = $(`label.awesome_map-category-${cat.parent}`);\n    $label.show();\n    // update number of items\n    $label.attr(\"title\", `${parseInt($label.attr(\"title\") || 0) + 1} ${window.DecidimAwesome.texts.items}`);\n    // show parent if apply\n    $parent.show();\n    $parent.attr(\"title\", `${parseInt($parent.attr(\"title\") || 0) + 1} ${window.DecidimAwesome.texts.items}`);\n  }\n\n  removeHiddenComponents() {\n    $(\".awesome_map-component\").each((_idx, el) => {\n      const layer = this.awesomeMap.layers[$(el).data(\"layer\")];\n      const $input = $(el).closest(\"div\").find(\"input:not(:checked)\");\n      if (layer && $input.length) {\n        this.awesomeMap.map.addLayer(layer.group);\n        this.awesomeMap.map.removeLayer(layer.group);\n      }\n    });\n  }\n\n  removeHiddenCategories() {\n    $(\".awesome_map-categories-selector:not(:checked)\").each((_idx, el) => {\n      const layer = this.awesomeMap.layers[$(el).closest(\"label\").data(\"layer\")];\n      if (layer) {\n        this.awesomeMap.map.addLayer(layer.group);\n        this.awesomeMap.map.removeLayer(layer.group);\n      }\n    });\n  }\n\n  updateHashtagLayers() {\n    // hide all\n    $(\".awesome_map-hashtags-selector\").each((_idx, el) => {\n      const layer = this.awesomeMap.layers[$(el).closest(\"label\").data(\"layer\")];\n      if (layer) {\n        this.awesomeMap.map.removeLayer(layer.group);\n      }\n    });\n    // show selected only\n    $(\".awesome_map-hashtags-selector:checked\").each((_idx, el) => {\n      const layer = this.awesomeMap.layers[$(el).closest(\"label\").data(\"layer\")];\n      if (layer) {\n        this.awesomeMap.map.addLayer(layer.group);\n      }\n    });\n    // hide non-selected categories\n    this.removeHiddenComponents();\n    this.removeHiddenCategories();\n  }\n\n  updateStats(uid, total) {\n    // update component stats\n    const $component = $(`#awesome_map-${uid}`);\n    $component.attr(\"title\", `${total} ${window.DecidimAwesome.texts.items}`);\n  }\n\n  _indeterminateParentInput(cat) {\n    if (cat.parent) {\n      let $input = $(`.awesome_map-category-${cat.parent}`).contents(\"input\");\n      let $subcats = $(`[class^=\"awesome_map-category-\"][data-parent=\"${cat.parent}\"]:visible`);\n      let num_checked = $subcats.contents(\"input:checked\").length;\n      $input.prop(\"indeterminate\", num_checked != $subcats.length && num_checked != 0);\n    }\n  }\n\n  // order hashtags alphabetically\n  _orderHashtags(_hashtag, $div) {\n    let $last = $div.contents(\"label:last\");\n    if ($last.prev(\"label\").length) {\n      // move the label to order it alphabetically\n      $div.contents(\"label\").each((_idx, el) => {\n        if ($(el).text().localeCompare($last.text()) > 0) {\n          $(el).before($last);\n          return false;\n        }\n      });\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}