{"ast":null,"code":"function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n/* eslint-disable require-jsdoc */\n\n/*\n* Since version 0.25 we follow a different strategy and opt to destroy and override completely the original editor\n* That's because editors are instantiated directly instead of creating a global function to instantiate them\n*/\n\n\nimport lineBreakButtonHandler from \"src/decidim/editor/linebreak_module\";\nimport InscrybMDE from \"inscrybmde\";\nimport Europa from \"europa\";\nimport \"inline-attachment/src/inline-attachment\";\nimport \"inline-attachment/src/codemirror-4.inline-attachment\";\nimport \"inline-attachment/src/jquery.inline-attachment\";\nimport hljs from \"highlight.js\";\nimport \"highlight.js/styles/github.css\"; // In 0.26 these files come with Decidim in the folder src/decidim/vendor so the awesome one's could be removed\n\nimport \"src/vendor/image-resize.min\";\nimport \"src/vendor/image-upload.min\";\nvar DecidimAwesome = window.DecidimAwesome || {};\nvar quillFormats = [\"bold\", \"italic\", \"link\", \"underline\", \"header\", \"list\", \"video\", \"image\", \"alt\", \"break\", \"width\", \"style\", \"code\", \"blockquote\", \"indent\"]; // A tricky way to destroy the quill editor\n\nexport function destroyQuillEditor(container) {\n  if (container) {\n    var content = $(container).find(\".ql-editor\").html();\n    $(container).html(content);\n    $(container).siblings(\".ql-toolbar\").remove();\n    $(container).find(\"*[class*='ql-']\").removeClass(function (index, class_name) {\n      return (class_name.match(/(^|\\s)ql-\\S+/g) || []).join(\" \");\n    });\n    $(container).removeClass(function (index, class_name) {\n      return (class_name.match(/(^|\\s)ql-\\S+/g) || []).join(\" \");\n    });\n\n    if ($(container).next().is(\"p.help-text\")) {\n      $(container).next().remove();\n    }\n  } else {\n    console.error(\"editor [\".concat(container, \"] not exists\"));\n  }\n}\nexport function createQuillEditor(container) {\n  var toolbar = $(container).data(\"toolbar\");\n  var disabled = $(container).data(\"disabled\");\n  var quillToolbar = [[\"bold\", \"italic\", \"underline\", \"linebreak\"], [{\n    list: \"ordered\"\n  }, {\n    list: \"bullet\"\n  }], [\"link\", \"clean\"], [\"code\", \"blockquote\"], [{\n    \"indent\": \"-1\"\n  }, {\n    \"indent\": \"+1\"\n  }]];\n  var addImage = false;\n\n  if (toolbar === \"full\") {\n    quillToolbar = [[{\n      header: [2, 3, 4, 5, 6, false]\n    }]].concat(_toConsumableArray(quillToolbar));\n\n    if (DecidimAwesome.allow_images_in_full_editor) {\n      quillToolbar.push([\"video\", \"image\"]);\n      addImage = true;\n    } else {\n      quillToolbar.push([\"video\"]);\n    }\n  } else if (toolbar === \"basic\") {\n    if (DecidimAwesome.allow_images_in_small_editor) {\n      quillToolbar.push([\"video\", \"image\"]);\n      addImage = true;\n    } else {\n      quillToolbar.push([\"video\"]);\n    }\n  } else if (DecidimAwesome.allow_images_in_small_editor) {\n    quillToolbar.push([\"image\"]);\n    addImage = true;\n  }\n\n  var modules = {\n    linebreak: {},\n    toolbar: {\n      container: quillToolbar,\n      handlers: {\n        \"linebreak\": lineBreakButtonHandler\n      }\n    }\n  };\n  var $input = $(container).siblings('input[type=\"hidden\"]');\n  container.innerHTML = $input.val() || \"\";\n  var token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n\n  if (addImage) {\n    modules.imageResize = {\n      modules: [\"Resize\", \"DisplaySize\"]\n    };\n    modules.imageUpload = {\n      url: $(container).data(\"uploadImagesPath\") || DecidimAwesome.editor_uploader_path,\n      method: \"POST\",\n      name: \"image\",\n      withCredentials: false,\n      headers: {\n        \"X-CSRF-Token\": token\n      },\n      callbackOK: function callbackOK(serverResponse, next) {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        next(serverResponse.url);\n      },\n      callbackKO: function callbackKO(serverError) {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        console.error(\"Image upload error: \".concat(serverError.message));\n      },\n      checkBeforeSend: function checkBeforeSend(file, next) {\n        $(\"div.ql-toolbar\").last().addClass(\"editor-loading\");\n        next(file);\n      }\n    };\n  }\n\n  var quill = new Quill(container, {\n    modules: modules,\n    formats: quillFormats,\n    theme: \"snow\"\n  });\n\n  if (disabled) {\n    quill.disable();\n  }\n\n  quill.on(\"text-change\", function () {\n    var text = quill.getText(); // Triggers CustomEvent with the cursor position\n    // It is required in input_mentions.js\n\n    var event = new CustomEvent(\"quill-position\", {\n      detail: quill.getSelection()\n    });\n    container.dispatchEvent(event);\n\n    if (text === \"\\n\" || text === \"\\n\\n\") {\n      $input.val(\"\");\n    } else {\n      $input.val(quill.root.innerHTML);\n    }\n  }); // After editor is ready, linebreak_module deletes two extraneous new lines\n\n  quill.emitter.emit(\"editor-ready\");\n\n  if (addImage) {\n    var text = $(container).data(\"dragAndDropHelpText\") || DecidimAwesome.texts.drag_and_drop_image;\n    $(container).after(\"<p class=\\\"help-text\\\" style=\\\"margin-top:-1.5rem;\\\">\".concat(text, \"</p>\"));\n  } // After editor is ready, linebreak_module deletes two extraneous new lines\n\n\n  quill.emitter.emit(\"editor-ready\");\n  return quill;\n}\nexport function createMarkdownEditor(container) {\n  var t = DecidimAwesome.texts.drag_and_drop_image;\n  var token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n  var $input = $(container).siblings('input[type=\"hidden\"]');\n  var $faker = $('<textarea name=\"faker-inscrybmde\"/>');\n  var $form = $(container).closest(\"form\");\n  var europa = new Europa();\n  $faker.val(europa.convert($input.val()));\n  $faker.insertBefore($(container));\n  $(container).hide();\n  var inscrybmde = new InscrybMDE({\n    element: $faker[0],\n    spellChecker: false,\n    renderingConfig: {\n      codeSyntaxHighlighting: true,\n      hljs: hljs\n    }\n  });\n  $faker[0].InscrybMDE = inscrybmde; // Allow image upload\n\n  if (DecidimAwesome.allow_images_in_markdown_editor) {\n    $(inscrybmde.gui.statusbar).prepend(\"<span class=\\\"help-text\\\" style=\\\"float:left;margin:0;text-align:left;\\\">\".concat(t, \"</span>\"));\n    inlineAttachment.editors.codemirror4.attach(inscrybmde.codemirror, {\n      uploadUrl: DecidimAwesome.editor_uploader_path,\n      uploadFieldName: \"image\",\n      jsonFieldName: \"url\",\n      extraHeaders: {\n        \"X-CSRF-Token\": token\n      }\n    });\n  } // convert to html on submit\n\n\n  $form.on(\"submit\", function () {\n    // e.preventDefault();\n    $input.val(inscrybmde.markdown(inscrybmde.value()));\n  });\n}","map":{"version":3,"mappings":"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","names":["lineBreakButtonHandler","InscrybMDE","Europa","hljs","DecidimAwesome","window","quillFormats","destroyQuillEditor","container","content","$","find","html","siblings","remove","removeClass","index","class_name","match","join","next","is","console","error","createQuillEditor","toolbar","data","disabled","quillToolbar","list","addImage","header","allow_images_in_full_editor","push","allow_images_in_small_editor","modules","linebreak","handlers","$input","innerHTML","val","token","attr","imageResize","imageUpload","url","editor_uploader_path","method","name","withCredentials","headers","callbackOK","serverResponse","last","callbackKO","serverError","message","checkBeforeSend","file","addClass","quill","Quill","formats","theme","disable","on","text","getText","event","CustomEvent","detail","getSelection","dispatchEvent","root","emitter","emit","texts","drag_and_drop_image","after","createMarkdownEditor","t","$faker","$form","closest","europa","convert","insertBefore","hide","inscrybmde","element","spellChecker","renderingConfig","codeSyntaxHighlighting","allow_images_in_markdown_editor","gui","statusbar","prepend","inlineAttachment","editors","codemirror4","attach","codemirror","uploadUrl","uploadFieldName","jsonFieldName","extraHeaders","markdown","value"],"sources":["/home/injam/.rbenv/versions/2.7.5/lib/ruby/gems/2.7.0/gems/decidim-decidim_awesome-0.8.3/app/packs/src/decidim/decidim_awesome/editors/editor.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\n\n/*\n* Since version 0.25 we follow a different strategy and opt to destroy and override completely the original editor\n* That's because editors are instantiated directly instead of creating a global function to instantiate them\n*/\n\nimport lineBreakButtonHandler from \"src/decidim/editor/linebreak_module\"\nimport InscrybMDE from \"inscrybmde\"\nimport Europa from \"europa\"\nimport \"inline-attachment/src/inline-attachment\";\nimport \"inline-attachment/src/codemirror-4.inline-attachment\";\nimport \"inline-attachment/src/jquery.inline-attachment\";\nimport hljs from \"highlight.js\";\nimport \"highlight.js/styles/github.css\";\n\n// In 0.26 these files come with Decidim in the folder src/decidim/vendor so the awesome one's could be removed\nimport \"src/vendor/image-resize.min\"\nimport \"src/vendor/image-upload.min\"\n\nconst DecidimAwesome = window.DecidimAwesome || {};\nconst quillFormats = [\"bold\", \"italic\", \"link\", \"underline\", \"header\", \"list\", \"video\", \"image\", \"alt\", \"break\", \"width\", \"style\", \"code\", \"blockquote\", \"indent\"];\n\n// A tricky way to destroy the quill editor\nexport function destroyQuillEditor(container) {\n  if (container) {\n    const content = $(container).find(\".ql-editor\").html();\n    $(container).html(content);\n    $(container).siblings(\".ql-toolbar\").remove();\n    $(container).find(\"*[class*='ql-']\").removeClass((index, class_name) => (class_name.match(/(^|\\s)ql-\\S+/g) || []).join(\" \"));\n    $(container).removeClass((index, class_name) => (class_name.match(/(^|\\s)ql-\\S+/g) || []).join(\" \"));\n    if ($(container).next().is(\"p.help-text\")) {\n      $(container).next().remove();\n    }\n  }\n  else {\n    console.error(`editor [${container}] not exists`);\n  }\n}\n\nexport function createQuillEditor(container) {\n  const toolbar = $(container).data(\"toolbar\");\n  const disabled = $(container).data(\"disabled\");\n\n  let quillToolbar = [\n    [\"bold\", \"italic\", \"underline\", \"linebreak\"],\n    [{ list: \"ordered\" }, { list: \"bullet\" }],\n    [\"link\", \"clean\"],\n    [\"code\", \"blockquote\"],\n    [{ \"indent\": \"-1\"}, { \"indent\": \"+1\" }]\n  ];\n\n  let addImage = false;\n\n  if (toolbar === \"full\") {\n    quillToolbar = [\n      [{ header: [2, 3, 4, 5, 6, false] }],\n      ...quillToolbar\n    ];\n    if (DecidimAwesome.allow_images_in_full_editor) {\n      quillToolbar.push([\"video\", \"image\"]);\n      addImage = true;\n    } else {\n      quillToolbar.push([\"video\"]);\n    }\n  } else if (toolbar === \"basic\") {\n    if (DecidimAwesome.allow_images_in_small_editor) {\n      quillToolbar.push([\"video\", \"image\"]);\n      addImage = true;\n    } else {\n      quillToolbar.push([\"video\"]);\n    }\n  } else if (DecidimAwesome.allow_images_in_small_editor) {\n    quillToolbar.push([\"image\"]);\n    addImage = true;\n  }\n\n  let modules = {\n    linebreak: {},\n    toolbar: {\n      container: quillToolbar,\n      handlers: {\n        \"linebreak\": lineBreakButtonHandler\n      }\n    }\n  };\n\n  const $input = $(container).siblings('input[type=\"hidden\"]');\n  container.innerHTML = $input.val() || \"\";\n  const token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n  if (addImage) {\n    modules.imageResize = {\n      modules: [\"Resize\", \"DisplaySize\"]\n    }\n    modules.imageUpload = {\n      url: $(container).data(\"uploadImagesPath\") || DecidimAwesome.editor_uploader_path,\n      method: \"POST\",\n      name: \"image\",\n      withCredentials: false,\n      headers: { \"X-CSRF-Token\": token },\n      callbackOK: (serverResponse, next) => {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\")\n        next(serverResponse.url);\n      },\n      callbackKO: (serverError) => {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\")\n        console.error(`Image upload error: ${serverError.message}`);\n      },\n      checkBeforeSend: (file, next) => {\n        $(\"div.ql-toolbar\").last().addClass(\"editor-loading\")\n        next(file);\n      }\n    }\n  }\n  const quill = new Quill(container, {\n    modules: modules,\n    formats: quillFormats,\n    theme: \"snow\"\n  });\n\n  if (disabled) {\n    quill.disable();\n  }\n\n  quill.on(\"text-change\", () => {\n    const text = quill.getText();\n\n    // Triggers CustomEvent with the cursor position\n    // It is required in input_mentions.js\n    let event = new CustomEvent(\"quill-position\", {\n      detail: quill.getSelection()\n    });\n    container.dispatchEvent(event);\n\n    if (text === \"\\n\" || text === \"\\n\\n\") {\n      $input.val(\"\");\n    } else {\n      $input.val(quill.root.innerHTML);\n    }\n  });\n  // After editor is ready, linebreak_module deletes two extraneous new lines\n  quill.emitter.emit(\"editor-ready\");\n\n  if (addImage) {\n    const text = $(container).data(\"dragAndDropHelpText\") || DecidimAwesome.texts.drag_and_drop_image;\n    $(container).after(`<p class=\"help-text\" style=\"margin-top:-1.5rem;\">${text}</p>`);\n  }\n\n  // After editor is ready, linebreak_module deletes two extraneous new lines\n  quill.emitter.emit(\"editor-ready\");\n\n  return quill;\n}\n\nexport function createMarkdownEditor(container) {\n  const t = DecidimAwesome.texts.drag_and_drop_image;\n  const token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n  const $input = $(container).siblings('input[type=\"hidden\"]');\n  const $faker = $('<textarea name=\"faker-inscrybmde\"/>');\n  const $form = $(container).closest(\"form\");\n  const europa = new Europa();\n  $faker.val(europa.convert($input.val()));\n  $faker.insertBefore($(container));\n  $(container).hide();\n  const inscrybmde = new InscrybMDE({\n    element: $faker[0],\n    spellChecker: false,\n    renderingConfig: {\n      codeSyntaxHighlighting: true,\n      hljs: hljs\n    }\n  });\n  $faker[0].InscrybMDE = inscrybmde;\n\n  // Allow image upload\n  if (DecidimAwesome.allow_images_in_markdown_editor) {\n    $(inscrybmde.gui.statusbar).prepend(`<span class=\"help-text\" style=\"float:left;margin:0;text-align:left;\">${t}</span>`);\n    inlineAttachment.editors.codemirror4.attach(inscrybmde.codemirror, {\n      uploadUrl: DecidimAwesome.editor_uploader_path,\n      uploadFieldName: \"image\",\n      jsonFieldName: \"url\",\n      extraHeaders: { \"X-CSRF-Token\": token }\n    });\n  }\n\n  // convert to html on submit\n  $form.on(\"submit\", () => {\n    // e.preventDefault();\n    $input.val(inscrybmde.markdown(inscrybmde.value()));\n  });\n}\n"]},"metadata":{},"sourceType":"module"}